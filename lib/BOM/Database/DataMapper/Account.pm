package BOM::Database::DataMapper::Account;

=head1 NAME

BOM::Database::DataMapper::Account

=head1 DESCRIPTION

This is a class that will collect general account queries.

=head1 VERSION

0.1

=cut

use Moose;
use Date::Utility;

use BOM::Database::AutoGenerated::Rose::Account::Manager;
use BOM::Database::Model::Account;
extends 'BOM::Database::DataMapper::AccountBase';

has '_mapper_model_class' => (
    is       => 'ro',
    isa      => 'Str',
    init_arg => undef,
    default  => 'BOM::Database::Model::Account',
);

=head1 METHODS

=over

=item get_balance

get balance of account

=cut

sub get_balance {
    my $self = shift;

    my $currency       = $self->currency_code;
    my $account_record = BOM::Database::AutoGenerated::Rose::Account::Manager->get_account(
        query => [
            client_loginid => $self->client_loginid,
            currency_code  => $currency
        ],
        db => $self->db,
    );

    return 0 unless @$account_record;
    return $account_record->[0]->balance;
}

no Moose;
__PACKAGE__->meta->make_immutable;

=back

=head1 AUTHOR

RMG Company

=head1 COPYRIGHT

(c) 2010 RMG Technology (Malaysia) Sdn Bhd

=cut

1;
