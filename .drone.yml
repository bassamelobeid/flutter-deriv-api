kind: pipeline
type: docker
name: core

clone:
  disable: true

image_pull_secrets:
- dockerconfig

steps:
- name: core tests
  image: regentmarkets/drone-git
  pull: always
  settings:
    ssh_key:
      from_secret: ssh_key
  commands:
  - sudo tee -a /etc/hosts < /home/git/regentmarkets/bom-postgres/hosts.db
  - /opt/ci/run.sh make test

---
kind: pipeline
type: docker
name: syntax

clone:
  disable: true

image_pull_secrets:
- dockerconfig

steps:
- name: redis-v6
  image: redis:6
  detach: true
- name: syntax tests
  image: regentmarkets/drone-git
  pull: always
  settings:
    ssh_key:
      from_secret: ssh_key
  commands:
  - sudo mkdir -p /home/website/www/temp
  - /opt/ci/run.sh make syntax

---
kind: pipeline
type: docker
name: unit

clone:
  disable: true

image_pull_secrets:
- dockerconfig

steps:
- name: unit tests
  image: regentmarkets/drone-git
  pull: always
  settings:
    ssh_key:
      from_secret: ssh_key
  commands:
  - /opt/ci/run.sh make unit

---
kind: pipeline
type: docker
name: localize

clone:
  disable: true

image_pull_secrets:
- dockerconfig

steps:
- name: Test translation strings
  image: regentmarkets/drone-git
  pull: always
  settings:
    ssh_key:
      from_secret: ssh_key
  commands:
  - /opt/ci/run.sh make localize

---
kind: pipeline
type: docker
name: translations

clone:
  disable: true

image_pull_secrets:
- dockerconfig

steps:
- name: Automated translations
  image: regentmarkets/drone-git
  pull: always
  settings:
    ssh_key:
      from_secret: ssh_key
  commands:
  - /opt/ci/run.sh bin/translation-build.sh
  when:
    event:
    - cron:
    cron:
    - dailycronname #change this to daily once ci test completely move to drone
