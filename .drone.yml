kind: pipeline
type: docker
name: syntax test

clone:
  disable: true

image_pull_secrets:
- dockerconfig

steps:
- name: test syntax
  image: regentmarkets/drone-git
  pull: always
  settings:
    ssh_key:
      from_secret: ssh_key
  commands:
    - /opt/circle/drone_prepare.sh
    - cd /home/git/regentmarkets/bom-config
    - . /etc/profile.d/perl5.sh
    - /opt/circle/start_services
    - /opt/circle/check_services
    - make syntax

---

kind: pipeline
type: docker
name: core test

clone:
  disable: true

image_pull_secrets:
- dockerconfig

steps:
- name: redis-v6
  image: redis:6
  detach: true
- name: test core
  image: regentmarkets/drone-git
  pull: always
  settings:
    ssh_key:
      from_secret: ssh_key
  commands:
    - /opt/circle/drone_prepare.sh
    - cd /home/git/regentmarkets/bom-config
    - . /etc/profile.d/perl5.sh
    - /opt/circle/start_services
    - /opt/circle/check_services
    - make test
