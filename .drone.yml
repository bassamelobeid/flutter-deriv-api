---
kind: pipeline
type: docker
name: core

clone:
  disable: true

steps:
- name: redis-v6
  image: redis:6
  detach: true
- name: test
  image: regentmarkets/drone-git
  pull: if-not-exists
  settings:
    ssh_key:
      from_secret: ssh_key
  environment:
    RPC_CONFIG: /home/git/regentmarkets/bom-rpc/rpc.conf.travis
  commands:
  - /opt/circle/drone_prepare.sh
  - cd /home/git/regentmarkets/bom-rpc
  - . /etc/profile.d/perl5.sh
  - /opt/circle/start_services
  - /opt/circle/check_services
  - make test

---
kind: pipeline
type: docker
name: syntax

clone:
  disable: true

steps:
- name: syntax
  image: regentmarkets/drone-git
  pull: if-not-exists
  settings:
    ssh_key:
      from_secret: ssh_key
  environment:
    RPC_CONFIG: /home/git/regentmarkets/bom-rpc/rpc.conf.travis
  commands:
  - /opt/circle/drone_prepare.sh
  - cd /home/git/regentmarkets/bom-rpc
  - . /etc/profile.d/perl5.sh
  - /opt/circle/start_services
  - /opt/circle/check_services
  - make syntax

---
kind: pipeline
type: docker
name: json_schemas

clone:
  disable: true

steps:
- name: redis-v6
  image: redis:6
  detach: true
- name: test
  image: regentmarkets/drone-git
  pull: if-not-exists
  settings:
    ssh_key:
      from_secret: ssh_key
  environment:
    RPC_CONFIG: /home/git/regentmarkets/bom-rpc/rpc.conf.travis
  commands:
  - /opt/circle/drone_prepare.sh
  - cd /home/git/regentmarkets/bom-rpc
  - . /etc/profile.d/perl5.sh
  - /opt/circle/start_services
  - /opt/circle/check_services
  - make json_schemas
