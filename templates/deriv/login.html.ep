<% if (!$login_method || stash('error') || stash('social_error')) { %>
    <div id="container">
        <h3 class="title-text"><%= l('Log in using your email') %></h3>
        <!--
            <p class="subtitle-text">
                <%= l('But first check if you are on') %>
                <a class="deriv-url" href="https://deriv.com" target="_blank" rel="noopener noreferrers">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="170" height="23" viewBox="0 0 170 23">
                        <defs>
                            <rect id="a" width="170" height="23" rx="11.5"/>
                        </defs>
                        <g fill="none" fill-rule="evenodd">
                            <g>
                                <use fill="#FFF" xlink:href="#a"/>
                                <use fill="#E5E5E5" fill-opacity=".5" xlink:href="#a"/>
                            </g>
                            <g fill-rule="nonzero">
                                <path fill="#979797" d="M18.5 6c2.34 0 3.718 1.787 3.87 4.072.37.146.63.506.63.928v5a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1v-5a1 1 0 0 1 .629-.929C14.78 7.788 16.159 6 18.5 6zm0 1c-1.621 0-2.7 1.167-2.863 3h5.725c-.164-1.833-1.241-3-2.862-3z"/>
                                <path fill="#9B9B9B" d="M31.02 6.12h.96v3.696h.048c.152-.352.366-.632.642-.84.276-.208.646-.312 1.11-.312.64 0 1.146.206 1.518.618.372.412.558.994.558 1.746V15h-.96v-3.804c0-1.112-.468-1.668-1.404-1.668-.192 0-.378.024-.558.072-.18.048-.342.12-.486.216a1.069 1.069 0 0 0-.342.366 1.04 1.04 0 0 0-.126.522V15h-.96V6.12zM39.204 15c-.336 0-.59-.094-.762-.282-.172-.188-.258-.434-.258-.738V9.648h-1.02v-.84h.576c.208 0 .35-.042.426-.126.076-.084.114-.23.114-.438V7.092h.864v1.716H40.5v.84h-1.356v4.512h1.26V15h-1.2zm4.212 0c-.336 0-.59-.094-.762-.282-.172-.188-.258-.434-.258-.738V9.648h-1.02v-.84h.576c.208 0 .35-.042.426-.126.076-.084.114-.23.114-.438V7.092h.864v1.716h1.356v.84h-1.356v4.512h1.26V15h-1.2zm2.844-6.192h.96v1.008h.048c.16-.392.394-.682.702-.87.308-.188.678-.282 1.11-.282.384 0 .732.076 1.044.228.312.152.578.368.798.648.22.28.388.62.504 1.02.116.4.174.848.174 1.344 0 .496-.058.944-.174 1.344-.116.4-.284.74-.504 1.02-.22.28-.486.496-.798.648-.312.152-.66.228-1.044.228-.84 0-1.444-.384-1.812-1.152h-.048V17.4h-.96V8.808zm2.556 5.472c.544 0 .972-.17 1.284-.51.312-.34.468-.786.468-1.338v-1.056c0-.552-.156-.998-.468-1.338-.312-.34-.74-.51-1.284-.51a2.1 2.1 0 0 0-.618.09c-.196.06-.366.142-.51.246-.144.104-.258.23-.342.378a.945.945 0 0 0-.126.474v2.304c0 .2.042.378.126.534.084.156.198.288.342.396.144.108.314.19.51.246.196.056.402.084.618.084zm6.264.864c-.576 0-1.058-.11-1.446-.33a3.29 3.29 0 0 1-1.002-.882l.684-.552c.24.304.508.538.804.702.296.164.64.246 1.032.246.408 0 .726-.088.954-.264.228-.176.342-.424.342-.744a.888.888 0 0 0-.234-.618c-.156-.172-.438-.29-.846-.354l-.492-.072a4.105 4.105 0 0 1-.792-.186 2.201 2.201 0 0 1-.63-.336c-.18-.14-.32-.314-.42-.522-.1-.208-.15-.456-.15-.744 0-.304.056-.57.168-.798.112-.228.266-.418.462-.57.196-.152.43-.266.702-.342.272-.076.564-.114.876-.114.504 0 .926.088 1.266.264.34.176.638.42.894.732l-.636.576a1.908 1.908 0 0 0-.6-.522c-.264-.156-.596-.234-.996-.234s-.702.086-.906.258c-.204.172-.306.406-.306.702 0 .304.102.524.306.66.204.136.498.236.882.3l.48.072c.688.104 1.176.302 1.464.594.288.292.432.674.432 1.146 0 .6-.204 1.072-.612 1.416-.408.344-.968.516-1.68.516zm4.716 0c-.256 0-.442-.064-.558-.192a.722.722 0 0 1-.174-.504v-.156c0-.208.058-.376.174-.504.116-.128.302-.192.558-.192.256 0 .442.064.558.192a.722.722 0 0 1 .174.504v.156a.722.722 0 0 1-.174.504c-.116.128-.302.192-.558.192zm0-4.872c-.256 0-.442-.064-.558-.192a.722.722 0 0 1-.174-.504V9.42c0-.208.058-.376.174-.504.116-.128.302-.192.558-.192.256 0 .442.064.558.192a.722.722 0 0 1 .174.504v.156a.722.722 0 0 1-.174.504c-.116.128-.302.192-.558.192zm1.86 6.54L64.788 6.12h.864L62.52 16.812h-.864zm4.596 0L69.384 6.12h.864l-3.132 10.692h-.864z"/>
                                <path fill="#333" d="M71.112 8.808h.936l.66 2.676.66 2.712h.024l.756-2.712.78-2.676h.852l.804 2.676.768 2.712h.024l.636-2.712.672-2.676h.9L77.94 15h-1.188l-.864-2.976-.54-1.884h-.024l-.528 1.884L73.932 15h-1.164l-1.656-6.192zm9.216 0h.936l.66 2.676.66 2.712h.024l.756-2.712.78-2.676h.852l.804 2.676.768 2.712h.024l.636-2.712.672-2.676h.9L87.156 15h-1.188l-.864-2.976-.54-1.884h-.024l-.528 1.884L83.148 15h-1.164l-1.656-6.192zm9.216 0h.936l.66 2.676.66 2.712h.024l.756-2.712.78-2.676h.852l.804 2.676.768 2.712h.024l.636-2.712.672-2.676h.9L96.372 15h-1.188l-.864-2.976-.54-1.884h-.024l-.528 1.884L92.364 15H91.2l-1.656-6.192zm10.476 6.336c-.256 0-.442-.064-.558-.192a.722.722 0 0 1-.174-.504v-.156c0-.208.058-.376.174-.504.116-.128.302-.192.558-.192.256 0 .442.064.558.192a.722.722 0 0 1 .174.504v.156a.722.722 0 0 1-.174.504c-.116.128-.302.192-.558.192zm6.612-1.152h-.048c-.376.768-.98 1.152-1.812 1.152-.384 0-.732-.076-1.044-.228a2.268 2.268 0 0 1-.798-.648 2.97 2.97 0 0 1-.504-1.02 4.821 4.821 0 0 1-.174-1.344c0-.496.058-.944.174-1.344.116-.4.284-.74.504-1.02.22-.28.486-.496.798-.648.312-.152.66-.228 1.044-.228.432 0 .802.094 1.11.282.308.188.542.478.702.87h.048V6.12h.96V15h-.96v-1.008zm-1.596.288c.216 0 .422-.028.618-.084a1.55 1.55 0 0 0 .51-.246c.144-.108.258-.24.342-.396.084-.156.126-.334.126-.534v-2.304a.945.945 0 0 0-.126-.474 1.184 1.184 0 0 0-.342-.378 1.727 1.727 0 0 0-.51-.246 2.1 2.1 0 0 0-.618-.09c-.544 0-.972.17-1.284.51-.312.34-.468.786-.468 1.338v1.056c0 .552.156.998.468 1.338.312.34.74.51 1.284.51zm6.924.864c-.424 0-.806-.076-1.146-.228a2.471 2.471 0 0 1-.876-.654 3.001 3.001 0 0 1-.564-1.02 4.218 4.218 0 0 1-.198-1.338c0-.488.066-.932.198-1.332s.32-.742.564-1.026c.244-.284.536-.502.876-.654.34-.152.722-.228 1.146-.228.416 0 .788.076 1.116.228.328.152.608.362.84.63.232.268.41.586.534.954.124.368.186.772.186 1.212v.456h-4.452v.288c0 .264.042.51.126.738a1.645 1.645 0 0 0 .936.99c.228.096.486.144.774.144.392 0 .734-.092 1.026-.276a1.81 1.81 0 0 0 .678-.792l.684.492a2.38 2.38 0 0 1-.936 1.026c-.424.26-.928.39-1.512.39zm0-5.676a1.82 1.82 0 0 0-.72.138 1.616 1.616 0 0 0-.558.39 1.832 1.832 0 0 0-.366.594 2.066 2.066 0 0 0-.132.75v.084h3.42v-.132c0-.552-.15-.994-.45-1.326-.3-.332-.698-.498-1.194-.498zM116.22 15V8.808h.96v1.14h.06a1.87 1.87 0 0 1 .6-.792c.288-.232.684-.348 1.188-.348h.372v.96h-.564c-.52 0-.926.098-1.218.294-.292.196-.438.442-.438.738V15h-.96zm4.884-7.644c-.208 0-.358-.05-.45-.15a.553.553 0 0 1-.138-.39V6.66c0-.16.046-.29.138-.39.092-.1.242-.15.45-.15.208 0 .358.05.45.15.092.1.138.23.138.39v.156c0 .16-.046.29-.138.39-.092.1-.242.15-.45.15zm-.48 1.452h.96V15h-.96V8.808zM124.992 15l-2.172-6.192h.96l1.08 3.072.672 2.112h.06l.672-2.112 1.104-3.072h.924L126.108 15h-1.116zm5.148.144c-.256 0-.442-.064-.558-.192a.722.722 0 0 1-.174-.504v-.156c0-.208.058-.376.174-.504.116-.128.302-.192.558-.192.256 0 .442.064.558.192a.722.722 0 0 1 .174.504v.156a.722.722 0 0 1-.174.504c-.116.128-.302.192-.558.192zm4.956 0c-.432 0-.82-.076-1.164-.228a2.378 2.378 0 0 1-.87-.648 2.888 2.888 0 0 1-.54-1.02 4.53 4.53 0 0 1-.186-1.344c0-.496.062-.944.186-1.344.124-.4.304-.74.54-1.02.236-.28.526-.496.87-.648a2.851 2.851 0 0 1 1.164-.228c.616 0 1.11.134 1.482.402.372.268.65.618.834 1.05l-.804.408a1.457 1.457 0 0 0-.552-.744c-.256-.176-.576-.264-.96-.264-.288 0-.54.046-.756.138-.216.092-.396.22-.54.384-.144.164-.252.36-.324.588a2.48 2.48 0 0 0-.108.75v1.056c0 .544.146.99.438 1.338.292.348.722.522 1.29.522.776 0 1.336-.36 1.68-1.08l.696.468a2.46 2.46 0 0 1-.894 1.068c-.396.264-.89.396-1.482.396zm6.072 0a2.79 2.79 0 0 1-1.14-.228 2.458 2.458 0 0 1-.882-.654 3.082 3.082 0 0 1-.57-1.02 4.104 4.104 0 0 1-.204-1.338c0-.488.068-.932.204-1.332.136-.4.326-.742.57-1.026.244-.284.538-.502.882-.654a2.79 2.79 0 0 1 1.14-.228c.416 0 .794.076 1.134.228.34.152.634.37.882.654.248.284.44.626.576 1.026.136.4.204.844.204 1.332 0 .496-.068.942-.204 1.338a3.024 3.024 0 0 1-.576 1.02 2.529 2.529 0 0 1-.882.654c-.34.152-.718.228-1.134.228zm0-.852c.52 0 .944-.16 1.272-.48.328-.32.492-.808.492-1.464v-.888c0-.656-.164-1.144-.492-1.464-.328-.32-.752-.48-1.272-.48s-.944.16-1.272.48c-.328.32-.492.808-.492 1.464v.888c0 .656.164 1.144.492 1.464.328.32.752.48 1.272.48zm4.38.708V8.808h.96v1.008h.048c.072-.16.154-.31.246-.45a1.54 1.54 0 0 1 .336-.366c.132-.104.286-.186.462-.246.176-.06.384-.09.624-.09.408 0 .784.098 1.128.294.344.196.6.518.768.966h.024c.112-.336.322-.63.63-.882s.726-.378 1.254-.378c.632 0 1.126.206 1.482.618.356.412.534.994.534 1.746V15h-.96v-3.804c0-.552-.108-.968-.324-1.248-.216-.28-.56-.42-1.032-.42-.192 0-.374.024-.546.072-.172.048-.326.12-.462.216a1.057 1.057 0 0 0-.324.366c-.08.148-.12.322-.12.522V15h-.96v-3.804c0-.552-.108-.968-.324-1.248-.216-.28-.552-.42-1.008-.42-.192 0-.376.024-.552.072-.176.048-.332.12-.468.216a1.04 1.04 0 0 0-.456.888V15h-.96z"/>
                            </g>
                        </g>
                    </svg>
                </a>
            </p>
        -->
        <div class="note-container">
            <svg height="51" width="51" class="binary-logo" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51 51"><defs><style>.cls-1{fill:#fefefe;}.cls-1,.cls-2{fill-rule:evenodd;}.cls-2{fill:#293052;}</style></defs><title>binary-logo graph-51px</title><g id="Logo_Light" data-name="Logo/Light"><g id="logo"><g id="Group"><path id="Fill-44" class="cls-1" d="M43.52,7.48a25.48,25.48,0,1,0,0,36,25.45,25.45,0,0,0,0-36"/><path id="Combined-Shape" class="cls-2" d="M18.18,32.29a4.85,4.85,0,0,0,2.12,3.18l-.53-.85s1-2.44-1.59-2.33M26.56,16.7a4.75,4.75,0,0,1,2.65,2.86c-2.54.64-2-2-2-2ZM40.13,40l-.74.74C33.56,45.54,29.1,43.1,29.1,43.1c-3.07-.64-4.55-.64-5.4-1.17-.21-.1-.85-.53-1.06-.42a2.09,2.09,0,0,1-2.34-.11l-.21-.21a1.73,1.73,0,0,1-.32-2.33c.22-.21-.21-.85-.21-.85s-1.16-1.7-1.91-2.76a7.43,7.43,0,0,1-.95-3.39h0c-.85-1.06-.95-1.38-1.27-1.8s-.43-.53-.64-.85l-.42-.42v-.11A3.74,3.74,0,0,1,15.75,27c.31-.21,1.48-.84,1.48-.84A2.29,2.29,0,0,1,19,25.08a7.48,7.48,0,0,1,3.4.53l.74.21a24.94,24.94,0,0,1,3.18,1.27,9.46,9.46,0,0,0,1.8.64c1.49.42,4.14-.85,4.77-1.38a3.58,3.58,0,0,0,1.38-1.91A1.15,1.15,0,0,0,34,23.7l-.53-.53-.1-.11c-2.55-2.76-2.12-4.45-2.12-4.45.1-1.27-.64-2-1.38-2.86l-.11-.11-.1-.11a22.07,22.07,0,0,0,3.92.85,11.11,11.11,0,0,0,1.8.11c1.38,0,2.33-.21,2.44-.43A19.79,19.79,0,0,1,34.3,15c-1.27-.53-1.48-.53-2.33-.85a20,20,0,0,1-2.23-.84C34.3,14.47,35.89,15,38,15c.85,0,1.27-.1,1.59-.1s1.27-.21,1.38-.64a13.29,13.29,0,0,1-2.65-.42C32.92,12,32.5,11.19,29.53,10A26.72,26.72,0,0,0,25,8.54a11.4,11.4,0,0,0-3.92,0c-4-1-5-.85-6.15-.64a20.73,20.73,0,0,1,25.76,2.76,22.94,22.94,0,0,1,2.55,3.07l.1.11a20.67,20.67,0,0,1,3.4,11.45A23.61,23.61,0,0,1,40.13,40ZM42.68,8.32a24.22,24.22,0,1,0,0,34.25,24.27,24.27,0,0,0,0-34.25Z"/></g></g></g></svg>
            <div class="note-wrapper">
                <h5 class="note-title"><%== l('Got a [_1] account?', '<strong>Binary.com</strong>') %></h5>
                <p class="note-text"><%== l('You can log in to [_1] with your [_2] username and password.', '<strong>Deriv</strong>', '<strong>Binary.com</strong>') %></p>
            </div>
        </div>
        <form id="frmLogin" method="POST">
            <div class="input-wrapper">
                <input id="txtEmail" name="email" placeholder="<%= l('example@email.com') %>" required autocomplete="off" autofocus="autofocus" maxlength="254" />
                <label for="txtEmail"><%= l('Email') %></label>
                <span class="bar"></span>
                <p class='hide error error_invalid'><%= l("That doesn't look like an email address.") %></p>
                <p class='hide error error_required'><%= l('Email is required.') %></p>
                <% if (stash('error')) { %>
                    <p class='error'><%= stash('error') %></p>
                <% } %>
            </div>
            <div class="input-wrapper">
                <input type="password" id="txtPass" name="password" placeholder="<%= l('Password') %>" required autocomplete="off" />
                <label for="txtPass"><%= l('Password') %></label>
                <span class="bar"></span>
                <span id="btnToggle" class="input-button icon_hidden"></span>
                <p class='hide error error_required'><%= l('Password is required.') %></p>
            </div>
            <div id="lost-password-container">
                <% if ($is_reset_password_allowed) { %>
                    <a id="lost-password" href="https://deriv.com/reset-password"><%= l('Forgot password?') %></a>
                <% } %>
                <button type="submit" class="button secondary" name="login" value="<%= l('Login') %>"><%= l('Login') %></button>
            </div>
            <input type="hidden" name="csrf_token" value="<%= $csrf_token %>" />
        </form>
        <% if ($use_social_login) { %>
            <div class="separator">
                <p class="center-text social-text">
                    <%= stash('error') ? l('Perhaps you signed up with a social account?') : l('Or use your social account') %>
                </p>
            </div>
            <div id="oa_social_login_container"></div>
            <% if (stash('social_error')) { %>
                <p class='error-oneall center-text'><%= stash('social_error') %></p>
            <% } %>
            <p class="account-text">
                <%== l('Don’t have an account yet? [_1]Create a new account[_2]', '<a class="account-link" href="https://deriv.com/?action=signup">', '</a>') %>
            </p>
        <% } %>
    </div>
<% } %>

<script type="text/javascript">
    var frmLogin, txtEmail, txtPass, btnToggle;
    window.onload = function() {
        frmLogin  = document.getElementById('frmLogin');
        txtEmail  = document.getElementById('txtEmail');
        txtPass   = document.getElementById('txtPass');
        btnToggle = document.getElementById('btnToggle');

        btnToggle.addEventListener('click', togglePasswordVisibility);

        if (frmLogin) {
            frmLogin.addEventListener('submit', function(e) {
                if (!validateAll()) {
                    e.preventDefault();
                    return false;
                }
            });
        }

        var fields = [
            { element: txtEmail, validator: validateEmail },
            { element: txtPass,  validator: validatePass },
        ];
        fields.forEach(function(field) {
            if (field.element) {
                ['change', 'blur'].forEach(function(event) {
                    field.element.addEventListener(event, function(e) {
                        field.validator();
                    });
                });
            }
        });
    };

    function validateAll() {
        return validateEmail() && validatePass();
    }

    function validateEmail() {
        return validateField(txtEmail, new RegExp(/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,63}$/));
    }

    function validatePass() {
        return validateField(txtPass, new RegExp(/^[ -~]{6,25}$/));
    }

    function validateField(element, regex) {
        if (element) {
            hideErrors(element);

            var hasError = true;
            var value = (element.value || '').trim();

            if (!value) {
                showError(element, 'required');
            } else if (!regex.test(value)) {
                showError(element, 'invalid');
            } else {
                hasError = false;
            }

            return !hasError;
        }
    }

    function hideErrors(element) {
        element.parentNode.classList.remove('has_error');
        element.parentNode.querySelectorAll('.error').forEach(function (el) {
            el.classList.add('hide');
        });
    }

    function showError(element, errorType) {
        element.parentNode.classList.add('has_error');
        var el = element.parentNode.querySelector('.error_' + errorType);
        if (el) {
            el.classList.remove('hide');
        }
    }

    function togglePasswordVisibility() {
        if (txtPass.type === 'password') {
            txtPass.type = 'text';
            btnToggle.classList.remove('icon_hidden');
            btnToggle.classList.add('icon_visible');
        } else {
            txtPass.type = 'password';
            btnToggle.classList.remove('icon_visible');
            btnToggle.classList.add('icon_hidden');
        }
    }
</script>

<script type="text/javascript">
    var use_social_login = '<%== $use_social_login %>';
    if (use_social_login) {
        var cb = '<%= $oneall_callback %>';
        var login_method = '<%= $login_method %>';
        var providers = <%== Mojo::JSON::encode_json($login_providers) %>;

        /* Embeds the buttons into the container oa_social_login_container */
        var _oneall = _oneall || [];
        _oneall.push(['social_login', 'set_force_re_authentication', true]);
        _oneall.push(['social_login', 'set_providers', providers]);
        _oneall.push(['social_login', 'set_callback_uri', cb]);
        _oneall.push(['social_login', 'set_popup_usage', 'never']);
        /* push all configs before this as once rendered it not possible to hook*/
        _oneall.push(['social_login', 'do_render_ui', 'oa_social_login_container']);

        if (login_method) {
            _oneall.push(['social_login', 'do_login', login_method]);
        }
        if (document.getElementById('frmLogin')) {
            document.getElementById('frmLogin').reset();
        }
    }
</script>
