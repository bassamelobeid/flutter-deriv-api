<style type="text/css">
table#client_edit{
    width:100%;
}
table#client_edit td{
    padding-top:4px;
}
.label{
    width:20%;
    text-align:right;
    text-transform:uppercase;
    vertical-align:top;
}
.small_header{
    background:#ffffff;
    text-transform:uppercase;
    font-weight:bold;
}
.poa_header {
    font-size:14px;
    color:red;
}
.vip_notice {
    font-size:14px;
    color:red;
}
.lspace {
    width: 80px;
    margin-left: 6px;
    font-weight: bold;
    display: inline-block;
}
.llspace {
    width: 160px;
    margin-left: 6px;
    font-weight: bold;
    display: inline-block;
}
</style>

[% yes_no_options = [{value => 1, text => 'yes'} {value => 0, text => 'no'}] %]

[% IF is_vip %]
    <h1 class="vip_notice">This is a VIP CLIENT since [% vip_since %]</h1>
[% END %]

<table border="0" width="100%" id="client_edit">
    <tr>
        <td class="label">Email</td>
        <td>: <b>[% client.email %]</b> (To edit client's email, <a href="[% request.url_for('backoffice/client_email.cgi', { email => client.email }) | none %]">click here</a>)</td>
    </tr>
    <tr>
        <td class="label">BROKER</td>
        <td>: <b>[% client.broker %]</b> <input type="hidden" name="edit_client_loginid" value="[% client.loginid %]"></td>
    </tr>
    <tr>
        [% last_check = client.sanctions_check.0%]
        <td class="label">Last sanctions check run</td>
        <td>: <b>[% last_check.result %]</b> [% last_check.tstmp %]</td>
    </tr>
    <tr>
        <td class="small_header" colspan="2">#AFFILIATE INFO</td>
    </tr>
    <tr>
        <td class="label">&nbsp;</td>
        <td>: <input type="text" name="myaffiliates_token" value="" /></td>
    </tr>
    <tr>
        <td class="label">Affiliate Token</td>
        <td>:[% client.myaffiliates_token %]
            (This is the token <strong>currently registered</strong> with MyAffiliates.)</td>
    </tr>

    <tr>
        <td class="small_header" colspan="2">#Identity</td>
    </tr>
    <tr>
        <td class="label">MrMs</td>
        <td>: 
            <select name="mrms">
            [% FOREACH salutation = mrms_options %]
                [% IF salutation ==  client.salutation %]
                    <option value="[% salutation %]" selected="selected">[% salutation %]</option>
                [% ELSE %]
                    <option value="[% salutation %]">[% salutation %]</option>
                [% END %]
            [% END %]
            </select>
        </td>
    </tr>
    <tr>
        <td class="label">First Name</td>
        <td>: <input type="text" name="first_name" value="[% client.first_name %]" size="50" /> [% client.first_name %]</td>
    </tr>
    <tr>
        <td class="label">Last Name</td>
        <td>: <input type="text" name="last_name" value="[% client.last_name %]" size="50" /> [% client.last_name %]</td>
    </tr>
    <tr>
        <td class="label">Date of Birth</td>
        <td>: 
            <select name="dob_day">[% dob_day_options | none %]</select>
            <select name="dob_month">[% dob_month_options | none %]</select>
            <select name="dob_year">[% dob_year_options | none %]</select>
        </td>
    </tr>
    <tr>
        <td class="label">Citizen</td>
        <td>: 
            <select name="citizen">
                [% IF client.citizen == "" %]
                    <option value="" selected="selected">Select Citizen</option>
                [% ELSE %]
                    <option value="">Select Citizen</option>
                [% END %]

            [% FOREACH country = countries %]
                [% IF country_codes.$country == client.citizen %]
                   <option value="[% country_codes.$country %]" selected="selected">[% country %]</option>
                [% ELSE %]
                   <option value="[% country_codes.$country %]">[% country %]</option>
                [% END %]
            [% END %]
            </select>
        </td>
    </tr>
    <tr>
        <td class="label">VIP Client?</td>
        <td>:
            <select name="is_vip">
                [% IF is_vip; yes_selected = 'selected="selected"'; ELSE; no_selected = 'selected="selected"'; END; %]
                <option value="1" [% yes_selected %]>YES</option>
                <option value="0" [% no_selected %]>NO</option>
            </select>
        </td>
    </tr>
    <tr>
        <td class="small_header" colspan="2">#Postal address</td>
    </tr>
    <tr>
        <td class="label">Address 1</td>
        <td>: <input type="text" name="address_1" value="[% client.address_1 %]" size="50" /> [% client.address_1 %]</td>
    </tr>
    <tr>
        <td class="label">Address 2</td>
        <td>: <input type="text" name="address_2" value="[% client.address_2 %]" size="50" /> [% client.address_2 %]</td>
    </tr>
    <tr>
        <td class="label">Town/City</td>
        <td>: <input type="text" name="city" value="[% client.city %]" size="50" /> [% client.city %]</td>
    </tr>
    <tr>
        <td class="label">State/Province</td>
        <td>: <select name="state">[% state_options | none %]</select> [% client.state %]</td>
    </tr>
    <tr>
        <td class="label">Postcode</td>
        <td>: <input type="text" name="postcode" value="[% client.postcode %]" size="10" /></td>
    </tr>
    <tr>
        <td class="label">Residence</td>
        <td>:
            <select name="residence" disabled="disabled">
                [% IF client.residence == "" %]
                    <option value="" selected="selected">Select Residence</option>
                [% ELSE %]
                    <option value="">Select Residence</option>
                [% END %]

            [% FOREACH country = countries %]
                [% IF country_codes.$country == client.residence %]
                   <option value="[% country_codes.$country %]" selected="selected">[% country %]</option>
                [% ELSE %]
                   <option value="[% country_codes.$country %]">[% country %]</option>
                [% END %]
            [% END %]
            </select>&nbsp;<span style="color:red;">Country can't be changed</span>
        </td>
    </tr>
    <tr>
        <td class="label">Birth Place</td>
        <td>:
            <select name="place_of_birth">
                [% IF client.place_of_birth == "" %]
                    <option value="" selected="selected">Select place of birth</option>
                [% ELSE %]
                    <option value="">Select place of birth</option>
                [% END %]

            [% FOREACH country = countries %]
                [% IF country_codes.$country == client.place_of_birth %]
                   <option value="[% country_codes.$country %]" selected="selected">[% country %]</option>
                [% ELSE %]
                   <option value="[% country_codes.$country %]">[% country %]</option>
                [% END %]
            [% END %]
            </select>
        </td>
    </tr>
    <tr>
        <td class="small_header" colspan="2">#TAX INFORMATION</td>
    </tr>
    <tr>
        <td class="label">Tax Residence</td>
        <td>:
            <select name="tax_residence">
                <option value="">Not selected</option>
            [% FOREACH country = countries %]
                [% IF country_codes.$country == client.tax_residence %]
                   <option value="[% country_codes.$country %]" selected="selected">[% country %]</option>
                [% ELSE %]
                   <option value="[% country_codes.$country %]">[% country %]</option>
                [% END %]
            [% END %]
            </select>
        </td>
    </tr>
    <tr>
        <td class="label">Tax Identification Number</td>
        <td>: <input type="text" name="tax_identification_number" value="[% client.tax_identification_number %]" size="10" /></td>
    </tr>
    <tr>
        <td class="small_header" colspan="2">#KYC/IDENTITY VERIFICATION</td>
    </tr>
    <tr>
        <td class="label">AML Risk Classification</td>
        [%
            risk_classification_options = [
                {'value' => 'low', 'details' => 'Low' }
                {'value' => 'standard', 'details' => 'Standard' }
                {'value' => 'high', 'details' => 'High' }
                {'value' => 'manual override - low', 'details' => 'Manual override - low' }
                {'value' => 'manual override - standard', 'details' => 'Manual override - standard' }
                {'value' => 'manual override - high', 'details' => 'Manual override - high' }
            ]
        %]
        <td>
            <select name="client_aml_risk_classification">
                [% FOREACH risk_classification = risk_classification_options %]
                    [% IF risk_classification.value == client.aml_risk_classification %]
                        <option value="[% risk_classification.value %]" selected="selected">[% risk_classification.details %]</option>
                    [% ELSE %]
                        <option value="[% risk_classification.value %]">[% risk_classification.details %]</option>
                    [% END %]
                [% END %]
            </select>
            Current risk classification: [% client.aml_risk_classification %]
        </td>
    </tr>
    <tr>
        <td class="label">ID Authentication</td>
        [%
            authentication_options = [
                {'value' => '', 'details' => 'Please select to update' }
                {'value' => 'CLEAR_ALL', 'details' => 'Not authenticated' }
                {'value' => 'ID_DOCUMENT', 'details' => 'Authenticated with scans' }
                {'value' => 'ID_NOTARIZED', 'details' => 'Authenticated with Notarized docs' }
            ]
        %]
        <td id="verification">:
            [%
                text;
                IF client.get_authentication('ID_DOCUMENT').status == 'pass';
                    text = 'Authenticated with scans,';
                END;
                IF client.get_authentication('ID_NOTARIZED').status == 'pass';
                    text = 'Authenticated with Notarized docs';
                END;
                IF not text;
                    text = 'Not authenticated';
                END;
            %]
            Current methods: [% text %]
            <select name="client_authentication">
                [% FOREACH authentication = authentication_options %]
                    [% IF  authentication.value == '' %]
                        <option value="[% authentication.value %]" selected="selected">[% authentication.details %]</option>
                    [% ELSE %]
                        <option value="[% authentication.value %]">[% authentication.details %]</option>
                    [% END %]
                [% END %]
            </select>

            <br/><br/>
            [%
                IF show_uploaded_documents;
                THEN;
                    'Expiry date format: dd-mon-yyyy or enter "clear" to clear it';
                    show_uploaded_documents | none;
                ELSE;
                    "There are no uploaded documents for $client.loginid - $client.full_name";
                END
            %]
[%
IF client.landing_company.short == "iom"
%]
            <br/>
            [%
                raw_url  = 'backoffice/view_192_raw_response.cgi';
                doc_url  = 'backoffice/download_document.cgi';
                args     = { loginID => client.loginid };
                pdf_args = { broker => client.broker, category => '192_result' };
                FOREACH auth_request IN [ proveID ];
                    option = auth_request.search_option;
                    IF auth_request.has_done_request;
                        args.search_option = option;
                        args.raw = 0; href_rpt = request.url_for(raw_url, args );
                        args.raw = 1; href_xml = request.url_for(raw_url, args );
                %]
                        An Experian <span class="lspace">[% option %]</span> request <span class="lspace">has</span> been done.
                        <a class="lspace" target="_blank" href="[% href_rpt | none %]">[Report]</a>
                        <a class="lspace" target="_blank" href="[% href_xml | none %]">[XML]</a>
                [%
                        IF auth_request.has_downloaded_pdf;
                            pdf_args.path = "pdf/${client.loginid}.${option}.pdf";
                %]
                            <a class="lspace" target="_blank" href="[% request.url_for(doc_url, pdf_args) | none %]">[PDF]</a>
                        [% END %]
                    [% ELSE %]
                        An Experian <span class="lspace">[% option %]</span> request <span class="lspace">has NOT</span> been done.
                    [%  END %]
                    <br/>
                [%  END %]
                <input type="submit" name="do_id_check" value="Submit a new ProveID request"/>
            <br/>
[% END %]
        </td>
    </tr>
    <tr>
        <td class="label">Age Verified</td>
        <td>:
            [% IF client.get_status('age_verification') %]
                YES
            [% ELSE %]
                NO
            [% END %]
        </td>
    </tr>
    <tr>
        <td class="label">Set Status Age Verified</td>
        <td>:
            <select name="age_verification">
                [% client_age_verified = client.get_status('age_verification') %]
                <option value="yes" [% IF client_age_verified %]selected="selected"[% END %]>YES</option>
                <option value="no" [% UNLESS client_age_verified %]selected="selected"[% END %]>NO</option>
            </select>
        </td>
    </tr>
    <tr>
        <td class="label">Account Opening Reason</td>
        <td>:
            [% client.account_opening_reason %]
        </td>
    </tr>
    <tr>
        <td class="small_header" colspan="2">#Custom Limits </td>
    </tr>
    [% IF self_exclusion_enabled == 'yes' %]
        <tr>
                <td colspan="2"> Client has enabled self-exclusion limits. Custom limits may not take effect until the self-exclusion period is over. </td>
        </tr>
    [% END %]
    <tr>
        <td class="label">Max Account Balance</td>
        <td>: <input type="text" name="custom_max_acbal" value="[% client.custom_max_acbal %]" size="20" placeholder="min: 1. Only integer"/>
         Currently enforced client limit:
         [% client.currency %] [% client.get_limit_for_account_balance %]
         [% IF self_exclusion_enabled == 'yes' && client.self_exclusion.max_balance %]
            (self-exclusion: [% client.currency %] [% client.self_exclusion.max_balance %])
         [% END %]
         </td>
    </tr>
    <tr>
        <td class="label">Max Daily Turnover</td>
        <td>: <input type="text" name="custom_max_daily_turnover" value="[% client.custom_max_daily_turnover %]" size="20" placeholder="min: 1. Only integer"/>
         Currently enforced client limit:
         [% client.currency %] [% client.get_limit_for_daily_turnover %]
         [% IF self_exclusion_enabled == 'yes' && client.self_exclusion.max_turnover %]
            (self-exclusion: [% client.currency %] [% client.self_exclusion.max_turnover %])
         [% END %]
        </td>
    </tr>
    <tr>
        <td class="label">Max Open Positions Payout</td>
        <td>: <input type="text" name="custom_max_payout" value="[% client.custom_max_payout %]" size="20" placeholder="min: 1. Only integer"/>
         Currently enforced client limit:
         [% client.currency %] [% client.get_limit_for_payout %]
        </td>
    </tr>
    <tr>
        <td class="small_header" colspan="2">#Communication Addresses</td>
    </tr>
    <tr>
        <td class="label">Tel</td>
        <td>: <input type="text" name="phone" value="[% client.phone %]" size="20" /> Note: this number's intl. code is: <b>[% client_phone_country %]</b></td>
    </tr>
    <tr>
        <td class="small_header" colspan="2">#Secrets</td>
    </tr>
    <tr>
        <td class="label">Secret question</td>
        <td>: <input type="text" name="secret_question" value="[% client.secret_question %]" size="50" /> [% secret_question %]</td>
    </tr>
    <tr>
        <td class="label">Secret answer</td>
        <td>: <input type="text" name="secret_answer" value="[% secret_answer %]" size="50" /> [% secret_answer %]</td>
    </tr>
    <tr>
        <td class="label">IP security</td>
        <td>: <input type="text" name="ip_security" value="[% client.restricted_ip_address %]" size="50" /></td>
    </tr>
    <tr>
        <td class="label">Cashier lock passowrd</td>
        <td>: <input type="text" name="cashier_lock_password" value="[% client.cashier_setting_password %]" size="50" /></td>
    </tr>

    <tr>
        <td class="small_header" colspan="2">#Promotional Code</td>
    </tr>
    <tr>
       [% maybe_disabled = promo_code_access ? '' : 'disabled' %]
       [% maybe_auth_msg = promo_code_access ? '' : '[Staff authorization required]' %]

        <td class="label">Promotional code</td>
        <td>:
            <input type="text" name="promo_code" [% maybe_disabled %] value="[% client.promo_code %]" size="20" />
            Description: [% client.client_promo_code.promotion.description %]
            (<a href="[% request.url_for('backoffice/promocode_edit.cgi', {promocode=>client.promo_code}) %]">edit</a>)
            [% IF maybe_auth_msg %]<font color="red"><b>[% maybe_auth_msg %]</b></font>[% END %]
        </td>
    </tr>
    <tr>
        <td class="label">Claim status</td>

        [%
            promo_code_options = [
                {'value' => 'NOT_CLAIM', 'details' => 'not claimed' }
                {'value' => 'CLAIM', 'details' => 'claimed' }
                {'value' => 'APPROVAL', 'details' => 'pending approval' }
                {'value' => 'REJECT', 'details' => 'rejected' }
                {'value' => 'CANCEL', 'details' => 'cancelled' }
            ]
        %]

        <td>:
            <select name="promo_code_status" [% maybe_disabled %]>
                [% IF not client.promo_code_status %]
                    <option value="" selected="selected">no status</option>
                [% ELSE %]
                    <option value="">no status</option>
                [% END %]

                [% FOREACH status = promo_code_options %]
                    [% IF client.promo_code_status == status.value %]
                        <option value="[% status.value %]" selected="selected">[% status.details %]</option>
                    [% ELSE %]
                        <option value="[% status.value %]">[% status.details %]</option>
                    [% END %]
                [% END %]
            </select>
            [% IF maybe_auth_msg %]<font color="red"><b>[% maybe_auth_msg %]</b></font>[% END %]
        </td>
    </tr>
    <tr>
        <td class="label">Apply date</td>
        <td>: [% client.promo_code_apply_date %] [% maybe_auth_msg %]
            [% IF maybe_auth_msg %]<font color="red"><b>[% maybe_auth_msg %]</b></font>[% END %]
        </td>
    </tr>
    <tr>
        <td class="small_header" colspan="2">#Marketing</td>
    </tr>
    <tr>
        <td class="label">Source</td>
        <td>: [% client.source%]</td>
    </tr>

    <tr>
        <td class="small_header" colspan="2">#WITHDRAWAL VIA PAYMENT AGENT</td>
    </tr>
    <tr>
        <td class="label">expiration_date</td>
        <td>: <input type="text" name="payment_agent_withdrawal_expiration_date"  value="[% client.payment_agent_withdrawal_expiration_date %]" size="20" />
             <i>format: YYYY-MM-DD (Optional)</i> Note: Allowed for withdrawal via payment agent until this date
        </td>
    </tr>

    <tr>
        <td class="small_header" colspan="2">#Misc</td>
    </tr>
    <tr>
        <td class="label">Latest environment</td>
        <td>: [% client.latest_environment %]</td>
    </tr>
    <tr>
        <td class="label">Date joined</td>
        <td>: [% client.date_joined %]<td>
    </tr>
    <tr>
        <td class="label">Password</td>
        <td>: [% client.password %]</td>
    </tr>
    [% IF show_funds_message %]
        <tr>
            <td class="label"><input type="checkbox" [% IF ukgc_funds_status %]checked[% END %] disabled="disabled"/></td>
            <td>The client acknowledges the funds level of protection are: medium</td>
        </tr>
    [% END %]
    [% IF show_tnc_status %]
        <tr>
            <td class="label"><input type="checkbox" [% IF tnc_approval_status %]checked[% END %] disabled="disabled"/></td>
            <td>Client acknowledges T&C [% client_tnc_version %]</td>
        </tr>
    [% END %]
    [% IF show_risk_approval %]
        <tr>
            <td class="label"><input type="checkbox" [% IF financial_risk_status %]checked[% END %] disabled="disabled"/></td>
            <td>Client acknowledges financial risk?</td>
        </tr>
    [% END %]
    [% FOREACH version = csr_tin_information %]
        <tr>
            <td class="label"><input type="checkbox" checked disabled="disabled"/></td>
            <td>[% version %]</td>
        </tr>
    [% END %]
    <tr>
        <td class="small_header" colspan="2">#Omnibus</td>
    </tr>
    [% IF show_allow_omnibus %]
        <tr>
            <td class="label">Allow Omnibus</td>
            <td>
                <input type="checkbox" value="1" name="allow_omnibus" [% IF client.allow_omnibus %]checked[% END %]/>
            </td>
        </tr>
    [% ELSIF client.sub_account_of %]
        <tr>
            <td class="label">Sub account of:</td>
            <td>[% client.sub_account_of %]</td>
        </tr>
    [% ELSE %]
        <tr>
            <td class="label">Facility not available</td>
            <td></td>
        </tr>
    [% END %]
</table>
