package BOM::Database::DAO::Report::ClientAccountReport;

use strict;
use warnings;

use BOM::Database::AutoGenerated::Rose::Users::LoginHistory::Manager;
use BOM::Database::UserDB;

sub get_logins_by_ip_and_login_age {
    my $args = shift;
    my $last_login_age = $args->{last_login_age} || 10;
    my $ip             = $args->{ip};

    my $logins = BOM::Database::AutoGenerated::Rose::Users::LoginHistory::Manager->get_login_history(
        db              => BOM::Database::UserDB::rose_db(),
        require_objects => ['binary_user'],
        query           =>
        [
            success         => 1,
            action          => 'login',
            environment     => { like => 'IP='.$ip.' %' },
            history_date    => { gt => DateTime->today()->subtract(days => $last_login_age) },
        ],
        sort_by         => 't1.history_date DESC'
    );

    use Data::Dumper;
    print Dumper($logins);

    return $logins;
}

1;
